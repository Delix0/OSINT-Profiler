<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSINT Report - {{ target.personal.full_name }}</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="glitch" data-text="OSINT PROFILER">OSINT PROFILER</h1>
                <div class="header-meta">
                    <span class="timestamp">Generated: {{ generated_at.strftime('%Y-%m-%d %H:%M:%S') }}</span>
                    <span class="target-id">ID: {{ target.id }}</span>
                </div>
            </div>
        </header>

        <!-- Profile Card -->
        <section class="profile-card">
            <div class="profile-header">
                <div class="profile-photo">
                    {% if target.personal.photo_url %}
                        <img src="{{ target.personal.photo_url }}" alt="Photo">
                    {% else %}
                        <div class="photo-placeholder">
                            <i class="fas fa-user"></i>
                        </div>
                    {% endif %}
                    <div class="status-indicator"></div>
                </div>
                <div class="profile-info">
                    <h2 class="name">{{ target.personal.full_name }}</h2>
                    {% if target.personal.birth_date %}
                    <p class="meta">
                        <i class="fas fa-birthday-cake"></i>
                        {{ target.personal.birth_date|format_date }} ({{ target.personal.birth_date|age }} лет)
                    </p>
                    {% endif %}
                    {% if target.personal.birth_place %}
                    <p class="meta">
                        <i class="fas fa-map-marker-alt"></i>
                        {{ target.personal.birth_place }}
                    </p>
                    {% endif %}
                    {% if target.personal.aliases %}
                    <div class="aliases">
                        <span class="label">Псевдонимы:</span>
                        {% for alias in target.personal.aliases %}
                        <span class="alias-tag">{{ alias }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <i class="fas fa-share-alt"></i>
                    <div class="stat-value">{{ target.stats.social_accounts }}</div>
                    <div class="stat-label">Соцсети</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div class="stat-value">{{ target.stats.connections }}</div>
                    <div class="stat-label">Связи</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-map-pin"></i>
                    <div class="stat-value">{{ target.stats.addresses }}</div>
                    <div class="stat-label">Адреса</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-briefcase"></i>
                    <div class="stat-value">{{ target.stats.jobs }}</div>
                    <div class="stat-label">Работа</div>
                </div>
            </div>
        </section>

        <!-- Contacts -->
        {% if target.contacts %}
        <section class="data-section">
            <h3 class="section-title">
                <i class="fas fa-address-book"></i>
                Контакты
            </h3>
            <div class="contacts-grid">
                {% if target.contacts.phones %}
                <div class="contact-group">
                    <div class="contact-label">Телефоны:</div>
                    {% for phone in target.contacts.phones %}
                    <div class="contact-item">
                        <i class="fas fa-phone"></i>
                        <a href="tel:{{ phone }}">{{ phone }}</a>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                {% if target.contacts.emails %}
                <div class="contact-group">
                    <div class="contact-label">Email:</div>
                    {% for email in target.contacts.emails %}
                    <div class="contact-item">
                        <i class="fas fa-envelope"></i>
                        <a href="mailto:{{ email }}">{{ email }}</a>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                
                {% if target.contacts.messengers %}
                <div class="contact-group">
                    <div class="contact-label">Мессенджеры:</div>
                    {% for messenger, handle in target.contacts.messengers.items() %}
                    <div class="contact-item">
                        <i class="fab fa-{{ messenger }}"></i>
                        <span>{{ handle }}</span>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </section>
        {% endif %}

        <!-- Social Media -->
        {% if target.social_media %}
        <section class="data-section">
            <h3 class="section-title">
                <i class="fas fa-hashtag"></i>
                Социальные сети
            </h3>
            <div class="social-grid">
                {% for social in target.social_media %}
                <div class="social-card">
                    <div class="social-header">
                        <i class="fab fa-{{ social.platform }}"></i>
                        <span class="platform-name">{{ social.platform|upper }}</span>
                    </div>
                    <a href="{{ social.url }}" target="_blank" class="social-username">
                        @{{ social.username }}
                    </a>
                    <div class="social-stats">
                        <span><i class="fas fa-users"></i> {{ social.followers }}</span>
                        <span><i class="fas fa-images"></i> {{ social.posts_count }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Family -->
        {% if target.family %}
        <section class="data-section">
            <h3 class="section-title">
                <i class="fas fa-home"></i>
                Семья
            </h3>
            <div class="family-tree">
                {% for member in target.family %}
                <div class="family-member">
                    <div class="member-relation">{{ member.relation|title }}</div>
                    <div class="member-name">{{ member.full_name }}</div>
                    {% if member.birth_year %}
                    <div class="member-info">
                        <i class="fas fa-calendar"></i>
                        {{ member.birth_year }} ({{ 2025 - member.birth_year }} лет)
                    </div>
                    {% endif %}
                    {% if member.occupation %}
                    <div class="member-info">
                        <i class="fas fa-briefcase"></i>
                        {{ member.occupation }}
                    </div>
                    {% endif %}
                    {% if member.workplace %}
                    <div class="member-info">
                        <i class="fas fa-building"></i>
                        {{ member.workplace }}
                    </div>
                    {% endif %}
                    {% if member.notes %}
                    <div class="member-notes">{{ member.notes }}</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Education -->
        {% if target.education %}
        <section class="data-section">
            <h3 class="section-title">
                <i class="fas fa-graduation-cap"></i>
                Образование
            </h3>
            <div class="timeline">
                {% for edu in target.education %}
                <div class="timeline-item">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <div class="timeline-header">
                            <h4>{{ edu.institution }}</h4>
                            <span class="timeline-date">
                                {{ edu.start_date|format_date('%Y') }} - 
                                {{ edu.end_date|format_date('%Y') if edu.end_date else 'настоящее время' }}
                            </span>
                        </div>
                        <p class="timeline-location">
                            <i class="fas fa-map-marker-alt"></i>
                            {{ edu.location }}
                        </p>
                        {% if edu.faculty %}
                        <p class="timeline-detail">{{ edu.faculty }}</p>
                        {% endif %}
                        {% if edu.specialization %}
                        <p class="timeline-detail">{{ edu.specialization }}</p>
                        {% endif %}
                        {% if edu.degree %}
                        <span class="badge">{{ edu.degree }}</span>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Employment -->
        {% if target.employment %}
        <section class="data-section">
            <h3 class="section-title">
                <i class="fas fa-briefcase"></i>
                Карьера
            </h3>
            <div class="timeline">
                {% for job in target.employment %}
                <div class="timeline-item">
                    <div class="timeline-marker"></div>
                    <div class="timeline-content">
                        <div class="timeline-header">
                            <h4>{{ job.position }}</h4>
                            <span class="timeline-date">
                                {{ job.start_date|format_date('%m.%Y') }} - 
                                {{ job.end_date|format_date('%m.%Y') if job.end_date else 'настоящее время' }}
                            </span>
                        </div>
                        <p class="company-name">
                            <i class="fas fa-building"></i>
                            {{ job.company }}
                        </p>
                        <p class="timeline-location">
                            <i class="fas fa-map-marker-alt"></i>
                            {{ job.location }}
                        </p>
                        {% if job.description %}
                        <p class="timeline-description">{{ job.description }}</p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Connections Graph -->
        {% if target.connections %}
        <section class="data-section">
            <h3 class="section-title">
                <i class="fas fa-project-diagram"></i>
                Граф связей
            </h3>
            <div id="network-graph"></div>
            <div class="connections-list">
                {% for connection in target.connections %}
                <div class="connection-card">
                    <div class="connection-header">
                        <span class="connection-name">{{ connection.name }}</span>
                        <span class="connection-relation">{{ connection.relation }}</span>
                    </div>
                    <p class="connection-context">{{ connection.context }}</p>
                    <div class="connection-meta">
                        <span class="source-tag">{{ connection.source }}</span>
                        <span class="strength-indicator">
                            {% for i in range(connection.strength) %}
                            <i class="fas fa-star"></i>
                            {% endfor %}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Addresses Map -->
        {% if target.addresses %}
        <section class="data-section">
            <h3 class="section-title">
                <i class="fas fa-map"></i>
                Карта адресов
            </h3>
            <div id="map"></div>
            <div class="addresses-list">
                {% for address in target.addresses %}
                <div class="address-card">
                    <div class="address-type">{{ address.type|title }}</div>
                    <p class="address-text">{{ address.address }}</p>
                    <p class="address-period">
                        {{ address.start_date|format_date }} - 
                        {{ address.end_date|format_date if address.end_date else 'настоящее время' }}
                    </p>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Timeline -->
        {% if target.timeline %}
        <section class="data-section">
            <h3 class="section-title">
                <i class="fas fa-clock"></i>
                Хронология событий
            </h3>
            <div class="events-timeline">
                {% for event in target.timeline %}
                <div class="event-item {{ event.category }}">
                    <div class="event-date">{{ event.date|format_date }}</div>
                    <div class="event-content">
                        <div class="event-title">{{ event.event }}</div>
                        <div class="event-location">{{ event.location }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Notes -->
        {% if target.notes %}
        <section class="data-section">
            <h3 class="section-title">
                <i class="fas fa-sticky-note"></i>
                Заметки
            </h3>
            <div class="notes-content">
                {{ target.notes }}
            </div>
        </section>
        {% endif %}

        <!-- Tags -->
        {% if target.tags %}
        <section class="data-section">
            <h3 class="section-title">
                <i class="fas fa-tags"></i>
                Теги
            </h3>
            <div class="tags-container">
                {% for tag in target.tags %}
                <span class="tag">{{ tag }}</span>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Footer -->
        <footer class="footer">
            <p>OSINT Profiler © 2025 | Confidential Report</p>
            <p class="footer-meta">Target ID: {{ target.id }} | Updated: {{ target.updated_at|format_date('%Y-%m-%d %H:%M') }}</p>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vis-network/9.1.2/dist/vis-network.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="../static/js/network-graph.js"></script>
    <script src="../static/js/map.js"></script>
    
    <script>
        // Данные для графа связей
        const connectionsData = {{ target.connections|tojson|safe if target.connections else '[]' }};
        const targetName = "{{ target.personal.full_name }}";
        
        // Данные для карты
        const addressesData = {{ target.addresses|tojson|safe if target.addresses else '[]' }};
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            if (connectionsData.length > 0) {
                initNetworkGraph(targetName, connectionsData);
            }
            if (addressesData.length > 0) {
                initMap(addressesData);
            }
        });
    </script>
</body>
</html>